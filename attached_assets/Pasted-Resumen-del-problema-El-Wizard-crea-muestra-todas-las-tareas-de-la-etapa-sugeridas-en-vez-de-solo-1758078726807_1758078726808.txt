Resumen del problema

El Wizard crea/muestra todas las tareas de la etapa (sugeridas) en vez de solo las seleccionadas en el Paso 2.

En la vista de etapa, las tarjetas no muestran claramente qué debe hacer el operario (inicio/fin/horas/cantidad/unidad/asignado/prioridad).

En el selector de Unidad aparece “Horas”, pero ya cargamos “Horas Est.” por separado.

El botón Eliminar seleccionadas (etapas/tareas) no refresca ni elimina en lote de forma fiable.

En errores del Wizard aún aparecen mensajes genéricos/HTML; deben ser JSON y mostrarse en el contenedor del paso.

Qué hay que hacer
1) Solo crear lo marcado en Paso 2

Usar exclusivamente las tareas tildadas en Paso 2 para:

la tabla del Paso 3,

el resumen del Paso 4,

y el payload de POST /obras/api/wizard-tareas/create.

Después de “Crear Tareas”, cerrar wizard y recargar la lista desde BD (no del catálogo), para mostrar solo lo realmente creado.

2) Tarjetas de tareas (vista de etapa)

En cada tarjeta, mostrar chips con: Inicio → Fin · Horas Est. · Cantidad + Unidad · Asignado · Prioridad.

Ejemplo: 18/09 → 25/09 · 40 h · 150 m² · momi giardina · Norm.

3) Unidades

Quitar “Horas” del selector de Unidad (las horas ya están en “Horas Est.”).

Si hay datos viejos con “Horas” como unidad, normalizar a un y mantener “Horas Est.” aparte.

4) Eliminar seleccionadas (bulk)

Conectar los checkboxes de etapas/tareas al botón “Eliminar seleccionadas”, eliminar en lote y refrescar la lista al terminar.

5) Errores del Wizard

Todas las respuestas de /obras/api/wizard-tareas/* deben ser application/json (sin HTML/redirects).

Mostrar el error en el contenedor del paso (no alert/pop-up ni “undefined”).

Criterios de aceptación (QA)

Paso 2: Tildo 1–2 tareas.
Paso 3/4: Solo aparecen esas tareas (no el resto del catálogo).

Crear tareas: al cerrar el wizard, en la etapa veo únicamente las creadas y con chips: Inicio → Fin · Horas · Cantidad + Unidad · Asignado · Prioridad.

Unidades: el combo no incluye “Horas”; si había registros antiguos con “Horas”, se ven como un y las horas siguen en “Horas Est.”.

Eliminar seleccionadas: marco varias y se borran todas; la lista se refresca.

Errores: cualquier fallo en preview/create se muestra en el paso correspondiente con mensaje JSON legible (sin HTML/DOCTYPE ni “undefined”).

Dónde tocar (orientativo)

Frontend: templates/obras/detalle.html (wizard: Paso 2→4, estado window.WIZARD, render de tarjetas, bulk delete).

Backend:

POST /obras/api/wizard-tareas/preview (esquema JSON consistente)

POST /obras/api/wizard-tareas/create (solo tareas seleccionadas)

Asegurar Content-Type: application/json y no redirigir a login en errores.