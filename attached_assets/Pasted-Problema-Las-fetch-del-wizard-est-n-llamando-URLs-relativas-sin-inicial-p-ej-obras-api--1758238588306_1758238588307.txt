Problema:
Las fetch del wizard están llamando URLs relativas sin “/” inicial (p.ej. obras/api/...). El navegador las resuelve contra /static/js/wizard.js → termina pidiendo /static/js/obras/api/... (404 HTML), y el front intenta parsear ese HTML como JSON → Unexpected token ‘<’.

Cambios a hacer (en static/js/wizard.js, o donde estén los loaders del wizard):

Helper de rutas absolutas

// siempre forzar rutas absolutas
const api = (p) => p.startsWith('/') ? p : `/${p}`;


Usar rutas absolutas en Paso 1 y Paso 2 (catálogo)

async function loadEtapasCatalogo(obraId) {
  const url = api(`obras/api/wizard-tareas/etapas?obra_id=${obraId}`);
  const data = await fetchJSON(url);
  // render...
}

async function loadTareasCatalogo(obraId, etapas) {
  const qs = new URLSearchParams({
    obra_id: obraId,
    etapas: JSON.stringify(etapas)
  }).toString();
  const url = api(`obras/api/wizard-tareas/tareas?${qs}`);
  const data = await fetchJSON(url);
  // render...
}


Endurecer fetchJSON para no romperse con HTML

async function fetchJSON(url, opts = {}) {
  const r = await fetch(url, { credentials: 'same-origin', ...opts });
  const ctype = r.headers.get('content-type') || '';
  const text = await r.text();

  if (!r.ok) {
    throw new Error(
      ctype.includes('application/json')
        ? (JSON.parse(text).error || `HTTP ${r.status}`)
        : `HTTP ${r.status} (no JSON): ${text.slice(0,120)}`
    );
  }
  if (!ctype.includes('application/json')) {
    throw new Error(`Respuesta no-JSON del servidor: ${text.slice(0,120)}`);
  }
  return JSON.parse(text);
}


No tocar:

Event delegation ya implementado para Finalizar y Confirmar.

Paso 2 usando catálogo.

Select “Asignado a” con placeholder en Paso 3.

Verificación (en el navegador):

Abrir el wizard en Paso 1 → pestaña Network:

GET /obras/api/wizard-tareas/etapas?obra_id=… → 200 con application/json.

Pasar a Paso 2 con etapas elegidas:

GET /obras/api/wizard-tareas/tareas?... → 200 JSON.

Sin errores “Unexpected token ‘<’”.

Nota: Si algún loader usa otra ruta, aplicar el mismo api(...) allí también.