Tarea: Wizard Paso 1 — etapa_ids llega vacío (400)

Síntoma

En el Paso 1, marco una etapa (ej. Mampostería) y al tocar Siguiente el POST a /obras/api/wizard-tareas/preview falla con 400 (Bad Request) porque el payload envía etapa_ids: [].

Logs del wizard:
Enviando payload preview: { obra_id: 18, etapa_ids: Array(0) }

Consola:

Hay 1 checkbox de etapa en el modal.

getSelectedEtapaIds() devuelve [].

El checkbox renderizado es input#etapa-mamposteria.form-check-input.etapa-checkbox con value = "on" y sin data-etapa-id. No hay otro dataset con el ID en el contenedor.

Causa raíz

El collector lee el ID desde data-etapa-id o, en su defecto, desde value numérico.
Hoy ninguno de los dos existe: el value está como "on" y no hay data-etapa-id.

Además hay desajuste de clase: en markup usan etapa-checkbox y el collector busca etapa-check (o viceversa). Con que quede una sola clase consistente ya alcanza.

Qué necesitamos que corrijas (sin cambiar Paso 2/3)

Markup de cada etapa (Paso 1):

Asegurar que cada checkbox tenga:

class="form-check-input etapa-check" (o mantener etapa-checkbox, pero el collector y el HTML deben coincidir).

name="etapa".

value="<ID numérico de la etapa>".

data-etapa-id="<ID numérico>".

(Opcional) id="etapa-<slug>" y data-etapa-slug="<slug>" para etiqueta/depuración.

Collector global:

window.getSelectedEtapaIds() debe existir y usar SIEMPRE los checkboxes del modal (Paso 1).

Debe leer el ID desde data-etapa-id o, si no está, desde value numérico.

Si preferís mantener la clase anterior, el collector puede aceptar ambas (.etapa-check y .etapa-checkbox), pero dejemos una sola de forma estable.

Handler de Paso 1:

El botón de avanzar type="button" (para no hacer submit clásico).

Armar el payload con getSelectedEtapaIds() y enviar { obra_id, etapa_ids } a /obras/api/wizard-tareas/preview.

Con respuesta OK, avanzar a Paso 2.

Cómo lo reproducís hoy

Abrir wizard de la obra (ej. obra_id=18).

Marcar Mampostería.

Ver logs: el contador sube a 1, pero getSelectedEtapaIds() → [].

POST /obras/api/wizard-tareas/preview → 400 porque etapa_ids va vacío.

Criterios de aceptación

Con una etapa tildada:

En consola: typeof getSelectedEtapaIds → "function".

getSelectedEtapaIds() → [<id_numérico>].

En Network: POST /obras/api/wizard-tareas/preview lleva {"obra_id": N, "etapa_ids":[<id>]} y devuelve 200.

El wizard pasa a Paso 2.