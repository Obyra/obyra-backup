Severidad: SEV-1 (regresiÃ³n)
MÃ³dulo: Wizard â€œCrear Tareas en Loteâ€
Estado actual del usuario:

Paso 1: selecciona etapas âœ…

Paso 2: marca tareas, panel â€œTareas Seleccionadasâ€ muestra X tareas âœ…

Paso 3: se generan las filas y completo fechas, horas, cantidad, etc. âœ…

Al dar Siguiente/Confirmar, el modal se re-renderiza y no se persiste nada âŒ

En Network no aparece ningÃºn POST; sÃ³lo GETs del catÃ¡logo.

Evidencia de consola (real del entorno)

ğŸ“Š WIZARD: Panel tareas actualizado â€“ N tareas seleccionadas

âœ… WIZARD: 2 filas generadas en Paso 3

Validaciones: ğŸš¦ requeridos vacÃ­os: [] (no hay campos obligatorios faltantes)

Pero no se ve ningÃºn POST en Network y el wizard â€œvuelve a empezarâ€.

DiagnÃ³stico

La regresiÃ³n original fue por IDs/atributos de los checkboxes del Paso 2 y por un ID de panel distinto entre HTML y JS. Eso ya estÃ¡ normalizado (panel se actualiza y se pasa a Paso 3).
Lo que sigue roto es el cierre del flujo: en Paso 3 el botÃ³n â€œSiguiente/Confirmarâ€ no dispara el submit real del formulario, por eso no hay POST y no se crean las tareas.

AdemÃ¡s, detectamos que a veces los IDs de tareas llegan como objetos y terminan viajando como "[object Object]". Hay que normalizarlos a strings antes del submit.

QuÃ© hay que corregir (checklist corto)

Paso 2 â€“ checkboxes de tareas (deberÃ­a quedar asÃ­; validar que estÃ©)

name="tasks[]"

value="<id_real>" (string)

data-id="<id_real>"

data-nombre="<nombre_tarea>"

clase tarea-checkbox
(esto hoy parece OK; sÃ³lo verificaciÃ³n).

Panel â€œTareas Seleccionadasâ€

El JS debe usar el ID que existe en el HTML (#tareas-seleccionadas-list o #selectedTasksList, el que realmente estÃ© en la plantilla).

Ya se ve el log â€œPanel tareas actualizado â€“ X tareas seleccionadasâ€, asÃ­ que sÃ³lo dejarlo consistente.

Paso 3 â€“ normalizar selecciÃ³n a strings
En wizard.js (funciÃ³n que arma Paso 3 / que captura Paso2â†’3):

Guardar selecciÃ³n en ambos estados por compatibilidad:

window.WZ_STATE.tareasSel = ['mamposteria-4','mamposteria-6', ...] (array de strings)

window.wizardState.selectedTaskIds = new Set([...])

Nunca guardar objetos en esos estados.

Paso 3 â€“ al avanzar, hacer submit real
En el handler del botÃ³n Siguiente/Confirmar de Paso 3:

Antes de enviar, inyectar inputs hidden tasks[] (uno por ID string), y motivo si es requerido.

Luego disparar form.requestSubmit().

Asegurarse de no impedir el submit con preventDefault() o con navegaciÃ³n interna antes del POST.

Si existe un Paso 4 de â€œConfirmarâ€, que ese botÃ³n haga el requestSubmit().

PseudocÃ³digo (para wizard.js):

function submitPaso3() {
  const form = document.querySelector('#wizardTareasModal form') || document.querySelector('form');
  if (!form) return;

  const idsRaw =
    (Array.isArray(window.WZ_STATE?.tareasSel) && window.WZ_STATE.tareasSel.length)
      ? window.WZ_STATE.tareasSel
      : Array.from(window.wizardState?.selectedTaskIds || []);

  const ids = [...new Set(idsRaw.map(x =>
    typeof x === 'string' ? x : (x?.id || x?.task_id || x?.tarea_id || x?.value)
  ).filter(Boolean))];

  // limpiar e inyectar
  form.querySelectorAll('input[name="tasks[]"]').forEach(n => n.remove());
  ids.forEach(id => {
    const i = document.createElement('input');
    i.type = 'hidden'; i.name = 'tasks[]'; i.value = String(id);
    form.appendChild(i);
  });

  // motivo si el back lo exige
  let m = form.querySelector('[name="motivo"], #motivo');
  if (!m) { m = document.createElement('input'); m.type = 'hidden'; m.name = 'motivo'; form.appendChild(m); }
  if (!m.value) m.value = 'CreaciÃ³n masiva desde el wizard';

  // enviar de forma tradicional
  form.requestSubmit();
}
// Wirear este submit a â€œConfirmarâ€ o al â€œSiguienteâ€ de Paso 3 segÃºn diseÃ±o actual.


No bloquear por â€œAsignado aâ€ vacÃ­o
El select â€œAsignado aâ€ aparece sin opciones (problema de datos/carga). No lo hagan required en esta entrega. Dejar esto para un ticket aparte.

QA de cierre (aceptaciÃ³n)

Abrir DevTools â†’ Network â†’ Clear

Completar Wizard hasta Paso 3, llenar campos.

Click en Confirmar/Guardar (o Siguiente si ahÃ­ se envÃ­a).

Debe aparecer una request Method: POST con Form Data conteniendo:

tasks[] = <id> (uno por cada tarea elegida; strings),

motivo (si aplica),

y el resto de los campos (inicio, fin, horas, cantidad, unidad, prioridad, asignado si corresponde).

Respuesta 2xx y las tareas quedan creadas.

Volver al dashboard/obra y verificar que las tareas estÃ©n asignadas.

Archivos a tocar

static/js/wizard.js (captura Paso2â†’3, normalizaciÃ³n de IDs, handler de submit).

templates/â€¦ del wizard sÃ³lo si hace falta ajustar el ID del panel ya existente.

Con esto se resuelve la regresiÃ³n (no-POST). Si necesitan, les paso vÃ­deo con la reproducciÃ³n y los logs que muestran que el panel y las filas de Paso 3 ya estÃ¡n OK pero falta el submit real.