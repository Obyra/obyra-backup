Lo que está pasando

En el Paso 1 del wizard, al tocar Siguiente (o al intentar auto-avanzar) aparece un pop-up:
“Unexpected token ‘<’, ‘<!DOCTYPE’ is not valid JSON”.

Eso indica que una request del wizard está devolviendo HTML (página de error/redirect) en vez de JSON.

Qué quiero que revises y corrijas

Identificar la request que rompe

Abrir DevTools → Network, reproducir el error y decirme:

URL exacta de la request que falla

Status (302/401/404/500)

Content-Type (ahora se ve text/html)

Esa request muy probablemente es a preview o a bulk_from_catalog.

Rutas y prefijos correctos

Las APIs del wizard deben estar bajo el blueprint /obras y ser exactamente:

POST /obras/api/obras/<obra_id>/etapas/bulk_from_catalog

POST /obras/api/wizard-tareas/preview

(y si la usa el Paso 1) GET /obras/api/wizard-tareas/etapas?obra_id=<id>

Si alguna está en otro path o sin el prefijo /obras, corregirla.

Siempre responder JSON (también en error)

Esas rutas deben devolver application/json tanto en éxito como en error (nada de HTML, ni redirects).

Si hay auth, no redirigir al login en /obras/api/...: devolver 401 JSON.

Para 404/500 en /obras/api/..., devolver JSON con un campo error.

Navegación del wizard

El front llama a gotoPaso(2). Necesito que exista una función global que avance de paso (puede ser un alias a la función real del wizard, ej. goToStep).

Alternativa: reemplazar las llamadas para que usen la función real de navegación que ya tiene el wizard.

Mensaje legacy

Ocultar/eliminar el texto rojo estático “Primero debes agregar etapas del catálogo…”. Los errores deben mostrarse con el mensaje JSON real.

Cómo sé que quedó OK (criterios de aceptación)

Marco 1–2 etapas en el catálogo y avanza solo al Paso 2 (sin tocar el botón verde).

Si toco Siguiente en Paso 1, también avanza (hace bulk + preview y pasa a Paso 2).

En Network, las rutas usadas (bulk_from_catalog y preview) responden application/json (no HTML).

Si algo falla, en el UI veo “Error: <mensaje>” (texto del JSON), sin el pop-up de <!DOCTYPE>.