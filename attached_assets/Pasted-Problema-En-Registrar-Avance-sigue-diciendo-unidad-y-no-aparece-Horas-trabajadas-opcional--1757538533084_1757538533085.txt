Problema: En “Registrar Avance” sigue diciendo “unidad” y no aparece “Horas trabajadas (opcional)”.
Objetivo: Mostrar la unidad real de la tarea (p. ej. m²) en la etiqueta y en el chip, y agregar el campo de Horas con conversión automática si hay rendimiento.

1) Template del modal (HTML/Jinja)

Reemplazar el bloque de “Cantidad ejecutada” por esto (adaptar ids/clases a tu UI):

{# Modal Registrar Avance #}
<form id="form-avance" action="{{ url_for('obras.crear_avance', tarea_id=tarea.id) }}" method="post" enctype="multipart/form-data">
  {{ csrf_token() }}
  <input type="hidden" name="tarea_id" value="{{ tarea.id }}">
  <input type="hidden" id="unidad" value="{{ tarea.unidad or 'un' }}">
  <input type="hidden" id="rendimiento" value="{{ tarea.rendimiento or '' }}">

  <div class="mb-3">
    <label for="cantidad" class="form-label">
      Cantidad ejecutada ({{ tarea.unidad or 'un' }}) *
    </label>
    <div class="input-group">
      <input type="number" step="0.01" min="0" id="cantidad" name="cantidad" class="form-control" required>
      <span class="input-group-text">{{ tarea.unidad or 'un' }}</span>
    </div>
  </div>

  <div class="mb-3">
    <label for="horas" class="form-label">Horas trabajadas (opcional)</label>
    <div class="input-group">
      <input type="number" step="0.01" min="0" id="horas" name="horas" class="form-control">
      <span class="input-group-text">h</span>
    </div>
    {# si existe rendimiento, mostramos ayuda #}
    {% if tarea.rendimiento %}
      <div class="form-text">Rendimiento: {{ tarea.rendimiento }} {{ tarea.unidad }}/h</div>
    {% endif %}
  </div>

  <div class="mb-3">
    <label class="form-label">Notas (opcional)</label>
    <textarea name="notas" class="form-control" rows="3" placeholder="Describir el trabajo realizado, materiales, etc."></textarea>
  </div>

  <div class="mb-3">
    <label class="form-label">Fotos del avance (opcional)</label>
    <input type="file" name="fotos" id="fotos" class="form-control" multiple>
    <div class="form-text">Puedes seleccionar múltiples fotos.</div>
  </div>

  <div class="d-flex justify-content-end gap-2">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button type="submit" class="btn btn-primary">Registrar Avance</button>
  </div>
</form>

2) JS (autoconversión cantidad ↔ horas si hay rendimiento)
<script>
(() => {
  const qty   = document.getElementById('cantidad');
  const horas = document.getElementById('horas');
  const r     = parseFloat(document.getElementById('rendimiento')?.value || '');

  // Si hay rendimiento (ej: 25 m²/h), permitimos completar uno y calculamos el otro
  if (!isNaN(r) && r > 0) {
    horas?.addEventListener('input', () => {
      if (horas.value && !qty.value) qty.value = (parseFloat(horas.value) * r).toFixed(2);
    });
    qty?.addEventListener('input', () => {
      if (qty.value && !horas.value) horas.value = (parseFloat(qty.value) / r).toFixed(2);
    });
  }
})();
</script>

3) Backend (guardar horas sin afectar % físico)

En el endpoint que crea el avance, leer también horas:

horas = request.form.get('horas', type=float)
cantidad = request.form.get('cantidad', type=float)
unidad = tarea.unidad  # copiar de la tarea

avance = AvanceTarea(
    tarea_id=tarea.id,
    user_id=current_user.id,
    cantidad=cantidad,
    unidad=unidad,
    horas=horas,
    notas=notas,
    estado='pendiente',
)


El % de avance se calcula con sum(cantidad aprobada) / objetivo.
Las horas son informativas (costos/productividad) y no cambian el %.

4) Criterios de aceptación

El modal muestra “Cantidad ejecutada (m²)” y el chip derecho también m² (o la unidad de la tarea).

Existe el campo “Horas trabajadas (opcional)”.

Si la tarea tiene rendimiento, completar horas autocompleta cantidad y viceversa.

Guardado OK: en la base queda unidad = m2 (o la que corresponda) y horas (si se cargó).